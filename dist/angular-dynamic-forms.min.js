angular.module("dynamicForms",[]),angular.element.prototype.closestAttribute=function(t){var e=this;return e.parent()&&"body"!==e.parent()[0].nodeName.toLowerCase()?e.parent().attr(t)?e.parent().attr(t):e.parent().closestAttribute(t):void 0},angular.module("dynamicForms").service("DfSchemaService",["DfUtils","$injector",function(t,e){var n=e.has("dynamicFormDefaults")?e.get("dynamicFormDefaults"):function(t){return{"ng-focus":"columnCtrl.onInputFocus()","ng-required":!0,type:t.type||"text",id:t.name,name:t.name}};this.findSchema=function(e){return t.getDependency(e.closestAttribute("df-schema"))},this.findColumn=function(t){return t.attr("df-column")||t.closestAttribute("df-column")},this.extractValue=function(t,e){var n=this.findSchema(t);return _(n).where({name:this.findColumn(t)}).pluck(e).value().pop()},this.extractColumn=function(t,n){var t=e.get(t);return _.find(t,{name:n})},this.extractValidators=function(t,r){var o=e.get(t),l=this.extractColumn(t,r);return _.chain(o).where({name:r}).pluck("validators").map(function(t){return _.defaults(t||{},n(l))}).value().pop()},this.prependColumnValue=function(t,e){var n=this.extractValue(t,e);t.prepend(n)},this.appendColumnValue=function(t,e){var n=this.extractValue(t,e),r=t.closestAttribute("df-controller"),o=t.closestAttribute("df-model-instance");t.append(_.template(n)({model:o,controller:r}))}}]),angular.module("dynamicForms").service("DfUtils",["$injector",function(t){var e={forMode:{write:"df-column-write",read:"df-column-read",edit:"df-column-edit"}};this.classForState=function(t){return e.forMode[t]},this.classesForStates=function(t){return _(t).map(function(t){return e.forMode[t]}).unique().value().join(" ")},this.getDependency=function(e){return e?t.get(e):void 0}}]),angular.module("dynamicForms").directive("dfModel",["$templateCache","DfUtils",function(t,e){function n(t){switch(t){case"radio":return"/radio.html";case"inputgroup":return"/inputgroup.html";case"checkbox":return"/checkbox.html";default:return"/input.html"}}return{restrict:"EA",priority:1100,compile:function(r,o){var l=e.getDependency(o.dfSchema),i=o.dfController,a=o.dfModelInstance,d=o.dfMode,c=o.ngForm;_.each(l,function(e){var l=t.get("templates/"+o.dfTemplate+n(e.type)),u=e.show?_.template(e.show)({controller:i,model:a,column:e,mode:d}):!0;r.append(t.get(e.template)||_.template(l)({column:e,form:c,show:u,mode:d}))})}}}]),angular.module("dynamicForms").controller("DfColumnController",["$scope","$element","$rootScope","DfUtils",function(t,e,n,r){var o={currentMode:e.closestAttribute("df-mode")||"write",element:e,input:void 0,savedValue:void 0,help:!1};this.registerInput=function(t){o.input=t,i(o.currentMode)},this.startEdit=function(){o.savedValue=o.input.val(),l("edit")},this.cancelEdit=function(){o.input.val(o.savedValue),o.input.triggerHandler("input"),l("read")},this.saveEdit=function(){o.input.controller("ngModel").$valid&&l("read")},this.onInputFocus=function(){n.$broadcast("df_input_focus",o.input.attr("id")),o.help=!0},this.toggleHelp=function(){o.help=!o.help},this.isReadonly=function(){return"read"===o.currentMode},this.displayHelp=function(){return o.help};var l=function(t){o.element.toggleClass(r.classesForStates([o.currentMode,t])),i(t),o.currentMode=t},i=function(t){o.input.attr("disabled","read"===t)};n.$on("df_input_focus",function(t){o.help=t===o.input.attr("id")})}]),angular.module("dynamicForms").directive("dfColumn",function(){return{restrict:"A",scope:!0,controller:"DfColumnController",controllerAs:"columnCtrl"}}),angular.module("dynamicForms").directive("dfEditControls",function(){return{restrict:"A",require:"^dfColumn",templateUrl:"directives/model/column/components/`df-edit-controls.html`"}}),angular.module("dynamicForms").run(["$templateCache",function(t){t.put("templates/default/input.html",'<div class="df-column" df-column="<%= column %>" df-mode="<%= mode %>">\r\n\r\n    <label df-label class="df-label"></label>\r\n\r\n    <div>\r\n        <input df-input class="df-input" />\r\n        <div class="messages">\r\n            <div df-edit class="df-edit"></div>\r\n            <div df-help class="df-help"></div>\r\n            <div df-validation class="df-validation"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div df-edit-controls class="df-edit-controls"></div>\r\n\r\n</div>'),t.put("templates/myaccount/input.html",'<div sy-form-group data-layout="form" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <label class="control-label" df-label ng-class="{\'label-required\': !optional}"></label>\r\n    <div>\r\n        <input type="text" class="form-control" df-input />\r\n\r\n        <div class="sy-form-error" df-validation>\r\n        </div>\r\n    </div>\r\n</div>'),t.put("templates/myaccount/radio.html",'<div sy-form-group data-layout="form" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <label class="control-label" df-label ng-class="{\'label-required\': !optional}"></label>\r\n    <div>\r\n        <input type="text" class="form-control" df-input />\r\n\r\n        <div class="sy-form-error" df-validation></div>\r\n    </div>\r\n</div>'),t.put("templates/npw/checkbox.html",'<div class="field-group" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <input type="checkbox" class="filter-input" df-input>\r\n    <label class="filter-label" df-label></label>\r\n</div>'),t.put("templates/npw/input.html",'<div class="field-group" df-column="<%= column.name %>" df-mode="<%= mode %>"\r\n     ng-class="{\'field-group-tooltip--active\': columnCtrl.displayHelp(), \'field-group--error\': <%= form %>.<%= column.name %>.$invalid && <%= form %>.<%= column.name %>.$dirty}"\r\n     ng-show="<%= show %>">\r\n\r\n    <div class="form-input-container">\r\n        <label class="form-label" df-label></label>\r\n        <input type="text" class="form-input" df-input />\r\n    </div>\r\n\r\n\r\n    <button type="button" class="form-tooltip-toggle" ng-click="columnCtrl.toggleHelp()">\r\n        <span>Show help information</span>\r\n    </button>\r\n\r\n    <!--Help-->\r\n    <div class="form-tooltip form-tooltip--feature-aside" df-help>\r\n    </div>\r\n\r\n    <!--Validation-->\r\n    <div class="form-error" df-validation>\r\n    </div>\r\n</div>\r\n'),t.put("directives/model/column/components/df-edit-controls.html",'<button class="df-cancel-edit" ng-click="columnCtrl.cancelEdit()">\r\n    Cancel\r\n</button>\r\n<button class="df-save-edit" ng-click="columnCtrl.saveEdit()">\r\n    Save\r\n</button>'),t.put("directives/model/column/components/df-edit.html",'<button class="df-edit-button" ng-click="columnCtrl.startEdit()" ng-if="columnCtrl.isReadonly()">\r\n    Edit\r\n</button>')}]),angular.module("dynamicForms").directive("dfEdit",function(){return{restrict:"A",require:"^dfColumn",templateUrl:"directives/model/column/components/df-edit.html"}}),angular.module("dynamicForms").directive("dfHelp",["$compile","DfSchemaService",function(t,e){return{restrict:"A",link:function(n,r,o){e.appendColumnValue(r,"help"),t(r.contents())(n)}}}]),angular.module("dynamicForms").directive("dfInput",["$compile","DfSchemaService",function(t,e){return{restrict:"A",priority:1050,require:"^dfColumn",compile:function(n,r){n.removeAttr("df-input");var o=n.closestAttribute("df-schema"),l=n.closestAttribute("df-column"),i=n.closestAttribute("df-model-instance")||"model",a=n.closestAttribute("df-controller"),d=n.closestAttribute("df-mode")||"write",c=e.extractColumn(o,l),u=e.extractValidators(o,l);if(c.show){var s=_.template(c.show)({controller:a,model:i,mode:d});u["ng-required"]="("+s+")  && ("+u["ng-required"]+")"}return _.each(u,function(t,e){n.attr(e,_.template(t)({controller:a,model:i}))}),n.attr("ng-model",i+"."+l),{pre:function(e,n){t(n)(e)},post:function(t,e,n,r){r.registerInput(e)}}}}}]),angular.module("dynamicForms").directive("dfLabel",["$compile","DfSchemaService",function(t,e){return{restrict:"A",priority:1e3,compile:function(t){e.prependColumnValue(t,"label");var n=e.findColumn(t);t.attr("for",n)}}}]),angular.module("dynamicForms").directive("dfValidation",["$compile","DfSchemaService",function(t,e){return{restrict:"A",priority:1e3,compile:function(t,n){e.appendColumnValue(t,"validation")}}}]);