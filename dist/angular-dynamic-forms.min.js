angular.module("dynamicForms",[]),angular.element.prototype.closestAttribute=function(n){var t=this;return t.parent()&&"body"!==t.parent()[0].nodeName.toLowerCase()?t.parent().attr(n)?t.parent().attr(n):t.parent().closestAttribute(n):void 0},angular.module("dynamicForms").service("DfSchemaService",["$injector","DfUtils",function(n,t){var e=n.has("dynamicFormDefaults")?n.get("dynamicFormDefaults"):function(n){return{"ng-focus":"columnCtrl.onInputFocus()","ng-required":!0,type:n.type||"text",id:n.name,name:n.name,placeholder:n.placeholder||n.name}};this.findSchema=function(n){return t.getDependency(n.closestAttribute("df-schema"))},this.findColumn=function(n){return n.attr("df-column")||n.closestAttribute("df-column")},this.getSchemaProps=function(n){return{schema:n.dfSchema,controller:n.dfController,model:n.dfModelInstance,mode:n.dfMode,form:n.ngForm,formStyle:n.dfFormStyle||"{}"}},this.getInputProps=function(n){var t={schema:n.closestAttribute("df-schema"),column:n.closestAttribute("df-column"),model:n.closestAttribute("df-model-instance")||"model",controller:n.closestAttribute("df-controller"),mode:n.closestAttribute("df-mode")||"write"};return t.columnDetails=this.extractColumn(t.schema,t.column),t.validators=this.extractValidators(t.schema,t.column),t},this.extractValue=function(n,t){var e=this.findSchema(n);return _(e).where({name:this.findColumn(n)}).pluck(t).value().pop()},this.extractColumn=function(t,e){var t=n.get(t);return _.find(t,{name:e})},this.extractValidators=function(t,r){var o=n.get(t),l=this.extractColumn(t,r);return _.chain(o).where({name:r}).pluck("validators").map(function(n){return _.defaults(n||{},e(l))}).value().pop()},this.prependColumnValue=function(n,t){var e=this.extractValue(n,t);n.prepend(e)},this.appendColumnValue=function(n,t){var e=this.extractValue(n,t),r=n.closestAttribute("df-controller"),o=n.closestAttribute("df-model-instance");n.append(_.template(e)({model:o,controller:r}))},this.getColumnValue=function(n,t){var e=this.extractValue(n,t),r=n.closestAttribute("df-controller"),o=n.closestAttribute("df-model-instance");return _.template(e)({model:o,controller:r})}}]),angular.module("dynamicForms").service("DfUtils",["$injector",function(n){var t={forMode:{write:"df-column-write",read:"df-column-read",edit:"df-column-edit"}};this.classForState=function(n){return t.forMode[n]},this.classesForStates=function(n){return _(n).map(function(n){return t.forMode[n]}).unique().value().join(" ")},this.getDependency=function(t){return t?n.get(t):void 0}}]),angular.module("dynamicForms").directive("dfModel",["$injector","$templateCache","DfUtils","DfSchemaService",function(n,t,e,r){function o(t){if(t.dfTemplate)return t.dfTemplate;var e=n.has("DfSessionService")?n.get("DfSessionService"):null;return e&&n.get(e).isLoggedIn()?"myaccount":"npw"}return{restrict:"EA",priority:1100,compile:function(n,l){var i=r.getSchemaProps(l),a=e.getDependency(i.schema),s=o(l),d=_.template(t.get("templates/"+s+"/wrapper.html"))(i);n.prepend(d),_.each(a,function(e){i.column=e;var r=t.get(e.template)||t.get("templates/"+s+"/"+(e.customType||e.type)+".html")||t.get("templates/"+s+"/input.html");i.show=e.show?_.template(e.show)(i):!0,n.find("mainform").append(_.template(r)(i))})}}}]),angular.module("dynamicForms").controller("DfColumnController",["$scope","$element","$rootScope","DfUtils",function(n,t,e,r){var o={currentMode:t.closestAttribute("df-mode")||"write",element:t,input:void 0,savedValue:void 0,help:!1};this.registerInput=function(n){o.input=n,i(o.currentMode)},this.startEdit=function(){o.savedValue=o.input.val(),o.help=!0,l("edit")},this.cancelEdit=function(){o.input.val(o.savedValue),o.input.triggerHandler("input"),l("read")},this.saveEdit=function(){o.input.controller("ngModel").$valid&&l("read")},this.onInputFocus=function(){e.$broadcast("df_input_focus",o.input.attr("id")),o.help=!0},this.toggleHelp=function(){o.help=!o.help},this.isReadonly=function(){return"read"===o.currentMode},this.inEdit=function(){return"edit"===o.currentMode},this.displayHelp=function(){return o.help};var l=function(n){i(n),o.currentMode=n},i=function(n){o.input.attr("readonly","read"===n)};e.$on("df_input_focus",function(n){o.help=n===o.input.attr("id")})}]),angular.module("dynamicForms").directive("dfColumn",function(){return{restrict:"A",scope:!0,controller:"DfColumnController",controllerAs:"columnCtrl"}}),angular.module("dynamicForms").directive("dfEditControls",function(){return{restrict:"A",require:"^dfColumn",templateUrl:"directives/model/column/components/df-edit-controls.html`"}}),angular.module("dynamicForms").directive("dfEdit",function(){return{restrict:"A",require:"^dfColumn",templateUrl:"directives/model/column/components/df-edit.html"}}),angular.module("dynamicForms").directive("dfHelp",["$compile","DfSchemaService",function(n,t){return{restrict:"A",link:function(e,r,o){var l=t.getColumnValue(r,"helpImage"),i=t.getColumnValue(r,"help");l?r.find("img").attr("src",l):r.find("img").remove(),i&&r.find("div p").append(i),n(r.contents())(e)}}}]),angular.module("dynamicForms").directive("dfInput",["$compile","DfSchemaService",function(n,t){return{restrict:"A",priority:1050,require:"^dfColumn",compile:function(e,r){e.removeAttr("df-input");var o=t.getInputProps(e);if(o.columnDetails.show){var l=_.template(o.columnDetails.show)(o);o.validators["ng-required"]="("+l+")  && ("+o.validators["ng-required"]+")"}return _.each(o.validators,function(n,t){e.attr(t,_.template(n)(o))}),e.attr("ng-model",o.model+"."+o.column),{pre:function(t,e){n(e)(t)},post:function(n,t,e,r){r.registerInput(t)}}}}}]),angular.module("dynamicForms").directive("dfValidation",["$compile","DfSchemaService",function(n,t){return{restrict:"A",priority:1e3,compile:function(n,e){t.appendColumnValue(n,"validation")}}}]),angular.module("dynamicForms").run(["$templateCache",function(n){n.put("templates/default/input.html",'<div class="df-column" df-column="<%= column %>" df-mode="<%= mode %>">\r\n\r\n    <label for="<%= column.name %>" class="df-label">\r\n        <%= column.label %>\r\n    </label>\r\n\r\n    <div>\r\n        <input df-input class="df-input" />\r\n        <div class="messages">\r\n            <div df-edit class="df-edit"></div>\r\n            <div df-help class="df-help"></div>\r\n            <div df-validation class="df-validation"></div>\r\n        </div>\r\n    </div>\r\n\r\n    <div df-edit-controls class="df-edit-controls"></div>\r\n\r\n</div>'),n.put("templates/myaccount/input.html",'<div sy-form-group data-layout="df-form-<%= mode %>" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <label class="control-label" for="<%= column.name %>" ng-class="{\'label-required\': \'<%= mode %>\' !== \'read\' && !(\'<%= column.optional %>\')}">\r\n        <%= column.label %>\r\n    </label>\r\n    <div>\r\n        <input type="text" class="form-control" df-input />\r\n\r\n        <div sy-alert-box="<%= column.name %>" df-validation>\r\n        </div>\r\n\r\n        <div sy-help></div>\r\n    </div>\r\n</div>'),n.put("templates/myaccount/radio.html",'<div sy-form-group data-layout="form" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <label class="control-label" for="<%= column.name %>" ng-class="{\'label-required\': !optional}">\r\n        <%= column.label %>\r\n    </label>\r\n    <div>\r\n        <input type="text" class="form-control" df-input />\r\n\r\n        <div class="sy-form-error" df-validation></div>\r\n    </div>\r\n</div>'),n.put("templates/myaccount/terms.html",'<div df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>" class="sy-form-group--terms-checkbox">\r\n    <label class="checkbox">\r\n        I have read, understand and agree with the <a sy-doc-href="terms.synergy">Terms and Conditions</a>, <a sy-doc-href="terms.privacy">Privacy Policy</a> and <a sy-doc-href="terms.collections">Collection of Information Statement</a> and I am authorised to enter into these Terms and Conditions.\r\n        <input type="checkbox" class="sy-checkbox" df-input>\r\n    </label>\r\n</div>'),n.put("templates/myaccount/wrapper.html","<div>\r\n    <mainform></mainform>\r\n</div>"),n.put("templates/npw/checkbox.html",'<div class="field-group" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n    <input type="checkbox" class="filter-input" df-input>\r\n    <label class="filter-label" for="<%= column.name %>">\r\n        <%= column.label %>\r\n    </label>\r\n</div>'),n.put("templates/npw/input.html",'<span ng-class="{\'sy-field-wrapper\': <%= show %>, \'submission-datalist-group\': \'<%= mode %>\' === \'read\', \'submission-datalist-group--active\': columnCtrl.inEdit()}" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n\r\n    <dt class="submission-datalist-label" ng-show="\'<%= mode %>\' === \'read\'"><span for="<%= column.name %>">\r\n        <%= column.label %>\r\n    </span></dt>\r\n\r\n    <dd ng-class="{\'submission-datalist-data\': \'<%= mode %>\' === \'read\'}">\r\n\r\n        <div class="field-group"\r\n             ng-class="{\'field-group-tooltip--active\': columnCtrl.displayHelp(), \'field-group--error\': <%= form %>.<%= column.name %>.$invalid && <%= form %>.<%= column.name %>.$dirty && <%= form %>.<%= column.name %>.hasVisited}">\r\n\r\n            <div class="form-input-container">\r\n                <label class="form-label" for="<%= column.name %>">\r\n                    <%= column.label %>\r\n                </label>\r\n                <input type="text" class="form-input" df-input />\r\n            </div>\r\n\r\n\r\n            <button type="button" class="form-tooltip-toggle" ng-click="columnCtrl.toggleHelp()">\r\n                <span>Show help information</span>\r\n            </button>\r\n\r\n            <!--Help-->\r\n            <div class="form-tooltip" df-help ng-class="{\'tooltip--image-with-caption\': \'<%= column.helpImage %>\'}">\r\n                <img src="" class="tooltip-image" alt=""/>\r\n                <div class="tooltip-description">\r\n                    <p></p>\r\n                </div>\r\n            </div>\r\n\r\n            <!--Validation-->\r\n            <div class="form-error" df-validation>\r\n            </div>\r\n        </div>\r\n\r\n    </dd>\r\n\r\n    <dd class="submission-datalist-edit" ng-show="\'<%= mode %>\' === \'read\'">\r\n        <button type="button" class="btn btn--cancel" ng-click="columnCtrl.cancelEdit()">Cancel</button>\r\n        <button type="button" class="btn btn--save" ng-click="columnCtrl.saveEdit()">Save</button>\r\n        <button type="button" class="btn btn--edit" ng-hide="<%= column.noEdit %>" ng-click="columnCtrl.startEdit()">Edit</button>\r\n    </dd>\r\n\r\n</span>'),n.put("templates/npw/privacy.html",'\r\n\r\n<span ng-class="{\'sy-field-wrapper\': <%= show %>, \'submission-datalist-group\': \'<%= mode %>\' === \'read\', \'submission-datalist-group--active\': columnCtrl.inEdit()}" df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n\r\n    <dt class="submission-datalist-label" ng-show="\'<%= mode %>\' === \'read\'"><span for="<%= column.name %>">\r\n        <%= column.label %>\r\n    </span></dt>\r\n\r\n    <dd ng-class="{\'submission-datalist-data\': \'<%= mode %>\' === \'read\'}">\r\n\r\n        <div class="field-group"\r\n             ng-class="{\'field-group-tooltip--active\': columnCtrl.displayHelp(), \'field-group--error\': <%= form %>.<%= column.name %>.$invalid && <%= form %>.<%= column.name %>.$dirty && <%= form %>.<%= column.name %>.hasVisited}">\r\n\r\n            <div class="form-input-description">\r\n                <div class="form-input-container">\r\n                    <label class="form-label" for="<%= column.name %>">\r\n                        <%= column.label %>\r\n                    </label>\r\n                    <input type="text" class="form-input" df-input />\r\n                </div>\r\n            </div>\r\n\r\n\r\n            <button type="button" class="form-tooltip-toggle" ng-click="columnCtrl.toggleHelp()">\r\n                <span>Show help information</span>\r\n            </button>\r\n\r\n            <!--Help-->\r\n            <div class="form-tooltip" df-help ng-class="{\'tooltip--image-with-caption\': \'<%= column.helpImage %>\'}">\r\n                <img src="" class="tooltip-image" alt=""/>\r\n                <div class="tooltip-description">\r\n                    <p></p>\r\n                </div>\r\n            </div>\r\n\r\n            <!--Validation-->\r\n            <div class="form-error" df-validation>\r\n            </div>\r\n        </div>\r\n\r\n    </dd>\r\n\r\n    <dd class="submission-datalist-edit" ng-show="\'<%= mode %>\' === \'read\'">\r\n        <button type="button" class="btn btn--cancel" ng-click="columnCtrl.cancelEdit()">Cancel</button>\r\n        <button type="button" class="btn btn--save" ng-click="columnCtrl.saveEdit()">Save</button>\r\n        <button type="button" class="btn btn--edit" ng-hide="<%= column.noEdit %>" ng-click="columnCtrl.startEdit()">Edit</button>\r\n    </dd>\r\n\r\n</span>'),n.put("templates/npw/terms.html",'<div class="field-group field-group field-group--checkbox"\r\n     ng-class="{\'field-group-tooltip--active\': columnCtrl.displayHelp(), \'field-group--error\': <%= form %>.<%= column.name %>.$invalid && <%= form %>.<%= column.name %>.$dirty}"\r\n     df-column="<%= column.name %>" df-mode="<%= mode %>" ng-show="<%= show %>">\r\n\r\n    <div class="form-input-container">\r\n        <input type="checkbox" class="form-input" df-input />\r\n        <label class="form-label" for="<%= column.name %>">\r\n            I have read, understand and agree with the <a sy-doc-href="terms.synergy">Terms and Conditions</a>, <a sy-doc-href="terms.privacy">Privacy Policy</a> and <a sy-doc-href="terms.collections">Collection of Information Statement</a> and I am authorised to enter into these Terms and Conditions.\r\n        </label>\r\n    </div>\r\n</div>'),n.put("templates/npw/wrapper.html","<div ng-class=\"{'submission-status-container submission-status-container--review': '<%= mode %>' === 'read'}\">\r\n    <fieldset class=\"form-section\" ng-init=\"formStyle=<%= formStyle %>\" ng-style=\"formStyle\">\r\n        <dl ng-class=\"{'submission-status-meta submission-datalist--review': '<%= mode %>' === 'read'}\">\r\n            <mainform>\r\n\r\n            </mainform>\r\n        </dl>\r\n    </fieldset>\r\n</div>"),n.put("directives/model/column/components/df-edit-controls.html",'<button class="df-cancel-edit" ng-click="columnCtrl.cancelEdit()">\r\n    Cancel\r\n</button>\r\n<button class="df-save-edit" ng-click="columnCtrl.saveEdit()">\r\n    Save\r\n</button>'),n.put("directives/model/column/components/df-edit.html",'<button class="df-edit-button" ng-click="columnCtrl.startEdit()" ng-if="columnCtrl.isReadonly()">\r\n    Edit\r\n</button>')}]);